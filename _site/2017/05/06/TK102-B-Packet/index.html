<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      TK-102B GPS Tracker Packet &middot; aldogint
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">
  <link rel="stylesheet" href="/blog/public/css/lanyon.css">
  <link rel="stylesheet" href="/blog/public/css/aldogint.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/blog/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>Personal blog to capture my programming journey.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/blog/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/blog/" title="Home">aldogint</a>
            <small>notes</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">TK-102B GPS Tracker Packet</h1>
  <span class="post-date">06 May 2017</span>
  <p>Recently i’m working with TK-102B GPS Tracker to make realtime bus tracker which will be accessible via Android phone. I was able to configure the device to send GPS information to my server. Unfortunalely, it’s sent in specific format that’s not described in device’s manual.</p>

<p>Digging information to parse this data was harder than i imagined. But thanks to <a href="https://traccar.org">traccar</a> and other project on github that i unfortunately i can’t remember, i finally manage to parse this information after reading their source code.
<!--more--></p>

<h3 id="packet-formats">Packet Formats</h3>
<p>This GPS tracker device send information in (at least) three possible formats:</p>
<ul>
  <li><code class="highlighter-rouge">(089072975034BO01255170422V0746.2053S11022.3651E000.1085146000.00,510,011,25323,45481,16,25323,34627,15,25323,45482,15,00000000L00000000)</code></li>
  <li><code class="highlighter-rouge">(087072975034BR00170426V0746.2066S11022.3650E000.2075501000.00,510,011,25323,45481,26,0,0,0,0,0,0,00000000L00000000)</code></li>
  <li><code class="highlighter-rouge">087072975034BP00HSO</code> (this one is probably handshake message)</li>
</ul>

<p>These formats have same first 12 characters which is its unique identifier. It’s built by prepending <code class="highlighter-rouge">0</code> to last 11 digits of IMEI. Then it’s followed by <code class="highlighter-rouge">'B'+...n chars</code> which is probably command idenfifier. After that, information about gps and device informations follow.</p>

<h3 id="parsing">Parsing</h3>
<p>After which figuring part of message i do need, i write a simple script to test it.</p>
<noscript><pre>/** begin testing */
var s = String(d);

var id = s.substr(1, 12);
// console.log(&#39;id: &#39;+id);

s = s.substr(13);

var command = s.substr(0, 2);
console.log(&quot;command &quot;+command)

s = s.substr(2);

if (command == &#39;BO&#39;) {
	var commandValue = s.substr(0, 5);
	s = s.substr(5);
	// console.log(&#39;BO executed&#39;);	
}
else if (command == &#39;BR&#39;) {
	var commandValue = s.substr(0, 2);
	s = s.substr(2);		
	// console.log(&#39;BR executed&#39;);		
}
else if (command == &#39;BP&#39;) {
	var commandValue = s.substr(0, 5);
	s = s.substr(5);		
	// console.log(&#39;BP executed&#39;);		
}
// console.log(&#39;command value: &#39;+commandValue);

var ymd = parseFloat(s.substr(0, 6));
// console.log(&quot;date (in &#39;ymd&#39; format):&quot;+ ymd);

s = s.substr(6);

var valid = s.substr(0, 1);
// console.log(&quot;valid?: &quot;+ valid);

s = s.substr(1);

// latitude
var lat = (s.indexOf(&#39;S&#39;)) ? s.substr(0, s.indexOf(&#39;S&#39;)) : s.substr(0, s.indexOf(&#39;N&#39;));
// console.log(&quot;lat: &quot;+lat);

// real latitude
var latD = parseFloat(lat.slice(0, -7));
var latM = parseFloat(lat.substr(lat.length-7));
var realLat = latD + latM/60;
// console.log(&#39;real latD: &#39;+ latD + &#39; latM: &#39; +latM);

s = s.substr(lat.length);

// north or south
var nos = s.substr(0, 1);
// console.log(&quot;nos: &quot; + nos);

s = s.substr(1);

// actual lat
var acLat = (nos == &#39;S&#39;) ? -1*realLat : realLat;
// console.log(&#39;actual lat: &#39; + acLat);

// longitude
var lng = (s.indexOf(&#39;E&#39;)) ? s.substr(0, s.indexOf(&#39;E&#39;)) : s.substr(0, s.indexOf(&#39;W&#39;));
// console.log(&quot;lng: &quot;+lng);

// real longitude
var lngD = parseFloat(lng.slice(0, -7));
var lngM = parseFloat(lng.substr(lng.length-7));
var realLng = lngD + lngM/60;
// console.log(&#39;real lng: &#39;+ realLng);

s = s.substr(lng.length);

// east or west
var eow = s.substr(0, 1);
// console.log(&quot;eow: &quot; + eow);

s = s.substr(1);

// actual longitude
var acLng = (eow == &#39;S&#39;) ? -1*realLng : realLng;
// console.log(&#39;actual lng: &#39; + acLng);

// speed		
var speed = s.substr(0, 5);
// console.log(&#39;speed: &#39;+speed);

s = s.substr(5);

// time		
var time = s.substr(0, 6);
// console.log(&#39;time: &#39;+time);

s = s.substr(6);

// heading		
var heading = s.substr(0, 6);
// console.log(&#39;heading: &#39;+heading);

s = s.substr(6);

// console.log(&#39;unknown: &#39; + s);

/** end of testing */</pre></noscript>
<script src="https://gist.github.com/aldogint/f350d44037dff96de414106bc04caea9.js"> </script>

<p>That’s it, we can finally parse message sent by this device.</p>

</div>

Share:
<div class="share-buttons">  
  <ul class="social-icons">
      <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/05/06/TK102-B-Packet/" class="social-icon"> <i class="fa fa-facebook"></i></a></li>
      <li><a href="https://twitter.com/intent/tweet?text=TK-102B GPS Tracker Packet&url=http://localhost:4000/2017/05/06/TK102-B-Packet/" rel="nofollow" target="_blank" title="Share on Twitter" class="social-icon"> <i class="fa fa-twitter"></i></a></li>
      <li><a href="https://plus.google.com/share?url=http://localhost:4000/2017/05/06/TK102-B-Packet/" class="social-icon"> <i class="fa fa-google-plus"></i></a></li>
      <li><a href="http://pinterest.com/pin/create/button/?url=http://localhost:4000/2017/05/06/TK102-B-Packet/&description=TK-102B GPS Tracker Packet" class="social-icon"> <i class="fa fa-pinterest"></i></a></li>
      <li><a href="http://www.reddit.com/submit?url=http://localhost:4000/2017/05/06/TK102-B-Packet/&title=TK-102B GPS Tracker Packet" class="social-icon"> <i class="fa fa-reddit"></i></a></li>
  </ul>
</div>


  <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://aldogint-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/2014/01/01/example-content/">
            Example content
            <small>01 Jan 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
